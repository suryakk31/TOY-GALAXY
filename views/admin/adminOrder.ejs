<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Order Management</title>
  <link rel="stylesheet" href="/css/admin/adminOrder.css">
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
  
  select {
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 16px;
    color: #333;
    cursor: pointer;
    width: 100%;
    box-sizing: border-box;
    transition: background-color 0.3s ease;
  }

  .status-pending {
    background-color: #e31010; /* Red */
    color: white;
  }

  .status-confirmed {
    background-color: #e1f151; /* Yellow */
    color: black;
  }

  .status-shipping {
    background-color: #22cde7; /* Blue */
    color: white;
  }

  .status-delivered {
    background-color: #10f123; /* Green */
    color: black;
  }

  .status-cancelled {
    background-color: #e31010; /* Red */
    color: white;
  }

  select:focus {
    border-color: #5b9bd5;
    outline: none;
  }

  </style>
</head>
<body>
  <header>
    <div class="top-nav">
      <div class="logo">
        <h1>Kids Kastle</h1>
      </div>
      <div class="search-bar">
        <input type="text" placeholder="Search...">
      </div>
      <div class="profile-logout">
        <a href="/logout" class="logout-btn">Logout</a>
      </div>
    </div>
  </header>
  <nav>
    <ul>
      <li><a href="/admin/adminDashboard"><i class='bx bx-home'></i> Dashboard</a></li>
      <li><a href="/admin/userManagement" ><i class='bx bx-user'></i> User Management</a></li>
      <li><a href="/admin/category"><i class='bx bx-category'></i> Category</a></li>
      <li><a href="/admin/products"><i class='bx bx-box'></i> Products</a></li>
      <li><a href="/admin/orders" class="active"><i class='bx bx-cart'></i> Orders</a></li>
      <li><a href="/sales-report"><i class='bx bx-line-chart'></i> Sales Report</a></li>
      <li><a href="/banner"><i class='bx bx-image'></i> Banner</a></li>
      <li><a href="/chat"><i class='bx bx-chat'></i> Chat</a></li>
      <li><a href="/analytics"><i class='bx bx-bar-chart-alt-2'></i> Analytics</a></li>
      <li><a href="/notifications"><i class='bx bx-bell'></i> Notifications</a></li>
      <li><a href="/settings"><i class='bx bx-cog'></i> Settings</a></li>
    </ul>
  </nav>
  <div class="order-table-container">
    <h2>Orders</h2>
    <table id="orderTable">
        <thead>
            <tr>
                <th>Name</th>
                <th>Phone Number</th>
                <th>Address</th>
                <th>Image</th>
                <th>Product Name</th>
                

                <th>Quantity</th>
                <th>Price</th>
                <th>Payment Method</th>
                <th>Order Date</th>
               
                <th>Order Status</th>
            </tr>
        </thead>
        <tbody>
          <% orders.forEach(order => { %>
              <tr>
                  <td><%= order.userId.firstName %></td>
                  <td><%= order.userId.phone %></td>
                  <td>
                      <%= order.address.name %>, <%= order.address.locality %>, <%= order.address.city %>, <%= order.address.state %> - <%= order.address.pincode %>
                  </td>
                  <td>
                    <% if(order.items && order.items.length > 0 && order.items[0].productId && order.items[0].productId.image && order.items[0].productId.image.length > 0) { %>
                        <img src="<%= order.items[0].productId.image[0] %>" alt="Product Image" style="width: 50px; height: 50px;">
                    <% } else { %>
                        <span>No Image Available</span>
                    <% } %>
                  </td>
                  <td>
                      <% if(order.items && order.items.length > 0) { %>
                          <%= order.items[0].productName %>
                      <% } else { %>
                          <span>No Product Name Available</span>
                      <% } %>
                  </td>
                  <td><%= order.totalQuantity %></td>
                  <td>â‚¹<%= order.totalPrice.toFixed(2) %></td>
                  <td><%= order.paymentMethod %></td>
                  <td><%= order.orderDate.toDateString() %></td>
                  <!-- <td><%= order.deliveryDate ? order.deliveryDate.toDateString() : 'N/A' %></td> -->
                  <td>
                    <form action="/admin/updateOrderStatus/<%= order._id %>" method="POST">
                      <input type="hidden" name="itemId" value="<%= order.items[0]._id %>">
                      <select name="status" onchange="this.form.submit()">
                          <option value="pending" <%= order.items[0].orderStatus === 'pending' ? 'selected' : '' %>>Pending</option>
                          <option value="confirmed" <%= order.items[0].orderStatus === 'confirmed' ? 'selected' : '' %>>Confirmed</option>
                          <option value="shipping" <%= order.items[0].orderStatus === 'shipping' ? 'selected' : '' %>>Shipping</option>
                          <option value="delivered" <%= order.items[0].orderStatus === 'delivered' ? 'selected' : '' %>>Delivered</option>
                          <option value="cancelled" <%= order.items[0].orderStatus === 'cancelled' ? 'selected' : '' %>>Cancelled</option>
                      </select>
                  </form>
                  
                  </td>
              </tr>
          <% }) %>
        </tbody>
        
      
    </table>
</div>

<script>
  function updateSelectColor(selectElement) {
 
    const selectedOption = selectElement.options[selectElement.selectedIndex];
    
    const statusClass = `status-${selectedOption.value}`;
    
   
    selectElement.className = ''; 
    selectElement.classList.add(statusClass);
  }


  document.querySelectorAll('select[name="status"]').forEach(select => {
    updateSelectColor(select);
    select.addEventListener('change', () => updateSelectColor(select));
  });
</script>



  
</body>
</html>
