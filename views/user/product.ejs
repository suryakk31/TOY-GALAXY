<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product Details</title>
  <link rel="stylesheet" href="/css/user/product.css">
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
  
  <style>
    .user-info {
      display: none;
      position: absolute;
      background-color: white;
      border: 1px solid #ddd;
      padding: 10px;
      right: 10px;
      top: 50px;
    }

  
        /* Dropdown Menu Styles */
.navbar-menu {
  list-style: none;
  padding: 0;
  margin: 0;
  display: flex;
}

.navbar-menu li {
  position: relative;
}

.navbar-menu a {
  text-decoration: none;
  padding: 15px;
  display: block;
  color: #000;
}

.navbar-menu .dropdown:hover .dropdown-menu {
  display: block;
}

.dropdown-menu {
  list-style: none;
  display: none;
  position: absolute;
  top: 100%;
  left: 0;
  background-color: #fff;
  box-shadow: 0 8px 16px rgba(0,0,0,0.2);
  z-index: 1000;
}

.dropdown-menu li {
  width: 200px;
  list-style: none;
}

.dropdown-menu a {
  padding: 10px;
  color: #000;
  text-decoration: none;
}

.dropdown-menu a:hover {
  background-color: #f0f0f0;
}


  </style>
</head>
<body>

  <%- include('../partials/header') %>
  

  <section class="product-details">
    <div class="product-gallery">
      <div class="thumbnails">
        <% if (product.image && product.image.length > 0) { %>
          <% product.image.forEach(function(image, index) { %>
            <img src="<%= image %>" alt="Thumbnail <%= index %>" class="thumbnail">
          <% }); %>
        <% } %>
      </div>
      <div class="main-image zoom-wrapper">
        <% if (product.image && product.image.length > 0) { %>
          <img src="<%= product.image[0] %>" alt="Product Image" id="current-image">
        <% } else { %>
          No Image
        <% } %>
      </div>
    </div>
    

    <div class="product-info">
      <h1><%= product.name %></h1>
      <div class="price-info">
        <!-- Display original price with strikethrough -->
        <span class="original-price" style="text-decoration: line-through;">₹<%= product.price %></span>
        
        <!-- Calculate and display discounted price -->
        <span class="discounted-price">₹<%= (product.price - (product.price * product.discount / 100)).toFixed(2) %></span>
        
        <span class="free-delivery"><p>(<%= product.discount %>% off)</p></span>
      </div>
      <div class="ratings">
        <span>⭐⭐⭐⭐⭐</span>
        <span>(123 reviews)</span>
      </div>
     
      

      <div class="category">
        <h4 style="font-weight: bold;">Category: 
          <span style="color: #131313; font-weight: normal;">
            <%= product.category ? product.category.name : 'No category assigned' %>
          </span>
        
          <h4 style="font-weight: bold;">Category offer: 
            <span style="color: #131313; font-weight: normal;">
              <%= product.category && product.category.offer ? product.category.offer + '%' : 'No category assigned' %>
            </span>
          </h4>

          <% if (product.stock === 0) { %>
            <p style="color: red;">Not available</p>
        <% } else if (product.stock < 5) { %>
            <p style="color: red;">Only <%= product.stock %> left in stock!</p>
        <% } %>
        
          


          
        
      </div>

      <div class="actions">
        <form action="/auth/cart" method="POST">
          <input type="hidden" name="productId" value="<%= product._id %>" />
          <button 
            type="submit"
            <% if (product.stock <= 0) { %> 
              disabled
            <% } %>
          >
            Add to Cart
          </button>
        </form>
        <a href="/auth/checkout?productId=<%= product._id %>">
          <button class="buy-now"
            <% if (product.stock <= 0) { %> 
              disabled
            <% } %>
          >
            Buy Now
          </button>
        </a>
      </div>
      
      

      <div class="product-description">
        <h3>Product Details</h3>
        <p><%= product.description %></p>
      </div>
    </div>
    </section>
    

 

  <%- include('../partials/footer') %>

  <script>
   
    
    document.querySelectorAll('.thumbnail').forEach(thumbnail => {
      thumbnail.addEventListener('click', function() {
        document.getElementById('current-image').src = this.src;
      });
    });

    document.addEventListener('DOMContentLoaded', function () {
      const mainImage = document.querySelector('.main-image img');

      mainImage.addEventListener('mousemove', function (e) {
        const { left, top, width, height } = mainImage.getBoundingClientRect();
        const x = ((e.pageX - left) / width) * 100;
        const y = ((e.pageY - top) / height) * 100;
        mainImage.style.transformOrigin = `${x}% ${y}%`;
      });
    });


    document.querySelector('.add-to-cart').addEventListener('click', function() {
    const productId = this.getAttribute('data-product-id');

    fetch('/add-to-cart', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ productId: productId })
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        window.location.href = '/cart';
      } else {
        alert('Failed to add item to cart.');
      }
    });
  });


  document.getElementById('buyNowButton').addEventListener('click', function() {
        const productId = this.getAttribute('data-product-id');
        window.location.href = `/auth/checkout?productId=${productId}`;
    });

  
  </script>
</body>
</html>
