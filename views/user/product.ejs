<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product Details</title>
  <link rel="stylesheet" href="/css/user/product.css">
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
  
  <style>
    .user-info {
      display: none;
      position: absolute;
      background-color: white;
      border: 1px solid #ddd;
      padding: 10px;
      right: 10px;
      top: 50px;
    }

  
        /* Dropdown Menu Styles */
.navbar-menu {
  list-style: none;
  padding: 0;
  margin: 0;
  display: flex;
}

.navbar-menu li {
  position: relative;
}

.navbar-menu a {
  text-decoration: none;
  padding: 15px;
  display: block;
  color: #000;
}

.navbar-menu .dropdown:hover .dropdown-menu {
  display: block;
}

.dropdown-menu {
  list-style: none;
  display: none;
  position: absolute;
  top: 100%;
  left: 0;
  background-color: #fff;
  box-shadow: 0 8px 16px rgba(0,0,0,0.2);
  z-index: 1000;
}

.dropdown-menu li {
  width: 200px;
  list-style: none;
}

.dropdown-menu a {
  padding: 10px;
  color: #000;
  text-decoration: none;
}

.dropdown-menu a:hover {
  background-color: #f0f0f0;
}


  </style>
</head>
<body>

  <nav class="navbar">
    <ul class="navbar-menu">
      <li><a href="<%= isLoggedIn ? '/auth/homepage' : '/' %>">Home</a></li>
      <li class="dropdown">
        <a href="<%= isLoggedIn ? '/auth/homepage' : '/' %>">Categories</a>
        <ul class="dropdown-menu">
          <% categories.forEach(category => { %>
            <li><a href="/category/<%= category._id %>"><%= category.name %></a></li>
          <% }) %>
        </ul>
      </li>
      <li><a href="<%= isLoggedIn ? '/auth/shop' : '/shop' %>">Shop</a></li>
      <li><a href="<%= isLoggedIn ? '/auth/blog' : '/blog' %>">Blog</a></li>
    </ul>
    <div class="logo">
      <i class='bx bxs-castle'></i><h1>Kids Kastle</h1>
    </div>
    <div class="navbar-right">
      <div class="navbar-search">
        <input type="text" placeholder="Search...">
        <button type="submit"><i class="bx bx-search"></i></button>
      </div>
      <div class="navbar-icons">
        <a href="<%= isLoggedIn ? 'javascript:void(0);' : '/auth/login' %>" id="user-icon"><i class="bx bx-user"></i></a>
        <% if (isLoggedIn && userDatabase) { %>
          <div class="user-info" id="user-info" style="display: none;">
            <a href="/auth/profile"><p>Hello, <%= userDatabase.firstName %></p></a>
            <a href="/auth/logout" id="logout-button">Log out</a>
          </div>
        <% } %>
        <a href="<%= isLoggedIn ? '/auth/wishlist' : '/wishlist' %>"><i class="bx bx-heart"></i></a>
        <a href="<%= isLoggedIn ? '/auth/cart' : '/cart' %>"><i class="bx bx-cart"></i></a>
      </div>
    </div>
  </nav>
  

  <section class="product-details">
    <div class="product-gallery">
      <div class="thumbnails">
        <% if (product.image && product.image.length > 0) { %>
          <% product.image.forEach(function(image, index) { %>
            <img src="<%= image %>" alt="Thumbnail <%= index %>" class="thumbnail">
          <% }); %>
        <% } %>
      </div>
      <div class="main-image zoom-wrapper">
        <% if (product.image && product.image.length > 0) { %>
          <img src="<%= product.image[0] %>" alt="Product Image" id="current-image">
        <% } else { %>
          No Image
        <% } %>
      </div>
    </div>
    

    <div class="product-info">
      <h1><%= product.name %></h1>
      <div class="price-info">
        <!-- Display original price with strikethrough -->
        <span class="original-price" style="text-decoration: line-through;">₹<%= product.price %></span>
        
        <!-- Calculate and display discounted price -->
        <span class="discounted-price">₹<%= (product.price - (product.price * product.discount / 100)).toFixed(2) %></span>
        
        <span class="free-delivery"><p>(<%= product.discount %>% off)</p></span>
      </div>
      <div class="ratings">
        <span>⭐⭐⭐⭐⭐</span>
        <span>(123 reviews)</span>
      </div>
     
      

      <div class="category">
        <h4 style="font-weight: bold;">Category: 
          <span style="color: #131313; font-weight: normal;">
            <%= product.category ? product.category.name : 'No category assigned' %>
          </span>
        
          <h4 style="font-weight: bold;">Category offer: 
            <span style="color: #131313; font-weight: normal;">
              <%= product.category && product.category.offer ? product.category.offer + '%' : 'No category assigned' %>
            </span>
          </h4>

          <% if (product.stock === 0) { %>
            <p style="color: red;">Not available</p>
        <% } else if (product.stock < 5) { %>
            <p style="color: red;">Only <%= product.stock %> left in stock!</p>
        <% } %>
        
          


          
        
      </div>

      <div class="actions">
        <form action="/auth/cart" method="POST">
          <input type="hidden" name="productId" value="<%= product._id %>" />
          <button 
            type="submit"
            <% if (product.stock <= 0) { %> 
              disabled
            <% } %>
          >
            Add to Cart
          </button>
        </form>
        <a href="/auth/checkout?productId=<%= product._id %>">
          <button class="buy-now"
            <% if (product.stock <= 0) { %> 
              disabled
            <% } %>
          >
            Buy Now
          </button>
        </a>
      </div>
      
      

      <div class="product-description">
        <h3>Product Details</h3>
        <p><%= product.description %></p>
      </div>
    </div>
    </section>
    

  <div class="user-info" id="user-info">
    <p>hello <%= userDatabase.firstName %></p>
    <a href="/auth/logout" id="logout-button">log out</a>
  </div>

  <footer class="footer">
    <div class="footer-content">
      <div class="footer-section logo-contact">
        <div class="logo">
          <i class='bx bxs-castle'></i><h1>Kids Kastle</h1>
        </div>
        <p>We’re available by phone -123-456-789</p>
        <p>info@example.com</p>
        <p>Monday till Friday 10 to 6 EST</p>
        <div class="social-icons">
          <a href="#"><i class='bx bxl-facebook'></i></a>
          <a href="#"><i class='bx bxl-instagram'></i></a>
          <a href="#"><i class='bx bxl-twitter'></i></a>
        </div>
      </div>
      <div class="footer-section useful-links">
        <h2>Useful links</h2>
        <ul>
          <li><a href="#">How it works</a></li>
          <li><a href="#">About us</a></li>
          <li><a href="#">Babysitters</a></li>
          <li><a href="#">Contact us</a></li>
        </ul>
      </div>
      <div class="footer-section my-account">
        <h2>My account</h2>
        <ul>
          <li><a href="#">Track my order</a></li>
          <li><a href="#">Terms of use</a></li>
          <li><a href="#">Wishlist</a></li>
          <li><a href="#">Submit your feedback</a></li>
        </ul>
      </div>
      <div class="footer-section customer-service">
        <h2>Customer service</h2>
        <ul>
          <li><a href="#">Help & contact us</li>
          <li><a href="#">Returns & refunds</a></li>
          <li><a href="#">Online stores</a></li>
          <li><a href="#">Terms & conditions</a></li>
        </ul>
      </div>
    </div>
  </footer>



  <script>
    document.getElementById('user-icon').addEventListener('click', function(event) {
      <% if (isLoggedIn) { %>
        event.preventDefault();
        var userInfo = document.getElementById('user-info');
        if (userInfo.style.display === 'none' || userInfo.style.display === '') {
          userInfo.style.display = 'block';
        } else {
          userInfo.style.display = 'none';
        }
      <% } %>
    });
    
    document.querySelectorAll('.thumbnail').forEach(thumbnail => {
      thumbnail.addEventListener('click', function() {
        document.getElementById('current-image').src = this.src;
      });
    });

    document.addEventListener('DOMContentLoaded', function () {
      const mainImage = document.querySelector('.main-image img');

      mainImage.addEventListener('mousemove', function (e) {
        const { left, top, width, height } = mainImage.getBoundingClientRect();
        const x = ((e.pageX - left) / width) * 100;
        const y = ((e.pageY - top) / height) * 100;
        mainImage.style.transformOrigin = `${x}% ${y}%`;
      });
    });

    document.getElementById('user-icon').addEventListener('click', function(event) {
      event.preventDefault();
      var userInfo = document.getElementById('user-info');
      if (userInfo.style.display === 'none' || userInfo.style.display === '') {
        userInfo.style.display = 'block';
      } else {
        userInfo.style.display = 'none';
      }
    });


    document.querySelector('.add-to-cart').addEventListener('click', function() {
    const productId = this.getAttribute('data-product-id');

    fetch('/add-to-cart', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ productId: productId })
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        window.location.href = '/cart';
      } else {
        alert('Failed to add item to cart.');
      }
    });
  });


  document.getElementById('buyNowButton').addEventListener('click', function() {
        const productId = this.getAttribute('data-product-id');
        window.location.href = `/auth/checkout?productId=${productId}`;
    });

  
  </script>
</body>
</html>
